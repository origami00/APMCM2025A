# 小问 2 求解步骤：B 样条轨迹优化 (遗传算法)

## 1. 数据输入
*   **读取约束参数**：
    *   总距离 $S = 10$ m
    *   平均速度 $v = 2$ m/s (隐含 $T \approx 5$ s)
    *   最大角速度 $\omega_{max} = 10^\circ/s$
    *   最大力矩 $\tau_{max} = 8$ N·m
*   **读取初始/终止状态**：$\theta_{start}=0$, $\theta_{end}$ (根据步态几何计算得出)。

## 2. 参数初始化 (GA 配置)
*   **种群规模 (PopSize)**：100
*   **迭代代数 (MaxGen)**：50 - 100
*   **变异概率 (Pm)**：0.1 (需在 [0.05, 0.2] 间调试，过大导致难以收敛，过小易陷局部最优)
*   **交叉概率 (Pc)**：0.8
*   **决策变量范围**：
    *   $T \in [4.5, 5.5]$ (在 5s 附近浮动)
    *   控制点 $P_1, P_2 \in [-30^\circ, 90^\circ]$ (符合膝关节物理限制)

## 3. 模型调用 (迭代寻优)
*   **步骤 3.1：种群初始化**
    *   随机生成 100 组 $[P_1, P_2, T]$ 向量。
*   **步骤 3.2：适应度评估 (循环)**
    *   对每个个体：
        1.  构建 3 次 B 样条函数 $\theta(t)$。
        2.  离散化时间 $t = 0:0.01:T$。
        3.  求导得到 $\dot{\theta}, \ddot{\theta}$。
        4.  计算动力学力矩 $\tau$。
        5.  **计算惩罚项**：
            $$ Penalty = \alpha \cdot (\sum \max(0, |\dot{\theta}|-10) + \sum \max(0, |\tau|-8)) $$
            *注意*：罚因子 $\alpha$ 需足够大（如 $10^5$），以确保违反约束的解被淘汰。
        6.  **计算目标函数**：$J = \int |\ddot{\theta}|^2 dt + Penalty$。
        7.  适应度 $Fitness = 1/J$。
*   **步骤 3.3：进化操作**
    *   执行轮盘赌选择、算术交叉、高斯变异，生成新一代种群。
    *   记录每代最佳适应度，绘制收敛曲线。

## 4. 结果输出
*   输出最优解向量 $[P_1^*, P_2^*, T^*]$。
*   绘制“关节角度-时间”曲线图。
*   绘制“角速度/力矩”曲线图，并画出红色约束线验证是否满足要求。

